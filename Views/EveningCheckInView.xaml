<UserControl x:Class="DailyCheckInJournal.Views.EveningCheckInView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">
            <TextBlock Text="Evening Check-In" FontSize="24" FontWeight="Bold" Margin="0,0,0,10"/>

            <!-- Must Do from Morning -->
            <GroupBox Header="Morning's Must-Do" Margin="0,0,0,15">
                <TextBlock Text="{Binding MustDoFromMorning, StringFormat='Must-Do: {}{0}'}" Margin="10" FontStyle="Italic" 
                           Visibility="{Binding MustDoFromMorning, Converter={StaticResource NullToVisibilityConverter}}"/>
            </GroupBox>

            <!-- Did Must-Do Happen? -->
            <GroupBox Header="Did the must-do happen?" Margin="0,0,0,15">
                <StackPanel Orientation="Horizontal" Margin="10">
                    <RadioButton Content="Yes" IsChecked="{Binding MustDoCompleted, Converter={StaticResource BoolToRadioConverter}, ConverterParameter=True}" Margin="10,0"/>
                    <RadioButton Content="No" IsChecked="{Binding MustDoCompleted, Converter={StaticResource BoolToRadioConverter}, ConverterParameter=False}" Margin="10,0"/>
                    <RadioButton Content="N/A" IsChecked="{Binding MustDoCompleted, Converter={StaticResource NullToRadioConverter}}" Margin="10,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Energy Level Now -->
            <GroupBox Header="Energy Level Now (1-10)" Margin="0,0,0,15">
                <StackPanel>
                    <Slider Value="{Binding EnergyLevel}" Minimum="1" Maximum="10" TickFrequency="1" IsSnapToTickEnabled="True" Margin="10"/>
                    <TextBlock Text="{Binding EnergyLevel, StringFormat='Energy: {}{0}'}" HorizontalAlignment="Center" FontSize="16"/>
                </StackPanel>
            </GroupBox>

            <!-- Overcommitted -->
            <GroupBox Header="Did you overcommit to anything today?" Margin="0,0,0,15">
                <StackPanel Orientation="Horizontal" Margin="10">
                    <RadioButton Content="Yes" IsChecked="{Binding Overcommitted, Converter={StaticResource BoolToRadioConverter}, ConverterParameter=True}" Margin="10,0"/>
                    <RadioButton Content="No" IsChecked="{Binding Overcommitted, Converter={StaticResource BoolToRadioConverter}, ConverterParameter=False}" Margin="10,0"/>
                    <RadioButton Content="N/A" IsChecked="{Binding Overcommitted, Converter={StaticResource NullToRadioConverter}}" Margin="10,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Common Mistakes -->
            <GroupBox Header="Common Mistakes" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    <Button Content="Add Mistake" Command="{Binding AddMistakeCommand}" HorizontalAlignment="Left" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding CommonMistakes}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="Gray" BorderThickness="1" Margin="0,5" Padding="10">
                                    <StackPanel>
                                        <ComboBox ItemsSource="{Binding DataContext.MistakeCategories, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                  SelectedItem="{Binding Category}" DisplayMemberPath="." Margin="0,0,0,5"/>
                                        <TextBlock Text="Tags (comma-separated):" Margin="0,0,0,5"/>
                                        <TextBox Text="{Binding Tags, Converter={StaticResource ListToStringConverter}}" Margin="0,0,0,5"/>
                                        <TextBox Text="{Binding FreeTextNotes}" MinHeight="50" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </GroupBox>

            <!-- Emotional State -->
            <GroupBox Header="Emotional State" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Overall Mood (1-10):" Width="200"/>
                        <Slider Value="{Binding EmotionalState.OverallMood}" Minimum="1" Maximum="10" TickFrequency="1" IsSnapToTickEnabled="True" Width="200"/>
                        <TextBlock Text="{Binding EmotionalState.OverallMood}" Margin="10,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Overwhelm Level (0-10):" Width="200"/>
                        <Slider Value="{Binding EmotionalState.OverwhelmLevel}" Minimum="0" Maximum="10" TickFrequency="1" IsSnapToTickEnabled="True" Width="200"/>
                        <TextBlock Text="{Binding EmotionalState.OverwhelmLevel}" Margin="10,0"/>
                    </StackPanel>
                    <CheckBox Content="Meltdown" IsChecked="{Binding EmotionalState.Meltdown}" Margin="0,0,0,5"/>
                    <CheckBox Content="Shutdown" IsChecked="{Binding EmotionalState.Shutdown}" Margin="0,0,0,10"/>
                    <TextBox Text="{Binding EmotionalState.Notes}" MinHeight="50" TextWrapping="Wrap"/>
                </StackPanel>
            </GroupBox>

            <!-- Habits -->
            <GroupBox Header="Habits" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    <ItemsControl ItemsSource="{Binding HabitEntries}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <CheckBox Content="{Binding HabitName}" IsChecked="{Binding Completed}" Margin="0,2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </GroupBox>

            <!-- Gratitude -->
            <GroupBox Header="Gratitude / Positives" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    <Button Content="Add Gratitude Item" Command="{Binding AddGratitudeCommand}" HorizontalAlignment="Left" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding GratitudeItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding .}" Margin="0,2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </GroupBox>

            <!-- Triggers -->
            <GroupBox Header="Triggers" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    <Button Content="Add Trigger" Command="{Binding AddTriggerCommand}" HorizontalAlignment="Left" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding Triggers}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="Gray" BorderThickness="1" Margin="0,5" Padding="10">
                                    <StackPanel>
                                        <TextBox Text="{Binding Description}" Margin="0,0,0,5"/>
                                        <TextBox Text="{Binding Category}" Margin="0,0,0,5"/>
                                        <TextBox Text="{Binding Notes}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </GroupBox>

            <!-- Coping Strategies -->
            <GroupBox Header="Coping Strategies" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    <Button Content="Add Coping Strategy" Command="{Binding AddCopingStrategyCommand}" HorizontalAlignment="Left" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding CopingStrategies}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="Gray" BorderThickness="1" Margin="0,5" Padding="10">
                                    <StackPanel>
                                        <TextBox Text="{Binding Strategy}" Margin="0,0,0,5"/>
                                        <CheckBox Content="Effective" IsChecked="{Binding Effective}" Margin="0,0,0,5"/>
                                        <TextBox Text="{Binding Notes}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </GroupBox>

            <!-- Notes -->
            <GroupBox Header="Additional Notes" Margin="0,0,0,15">
                <TextBox Text="{Binding Notes}" MinHeight="100" TextWrapping="Wrap" AcceptsReturn="True" Margin="10"/>
            </GroupBox>

            <!-- Success Message -->
            <Border Background="#E8F5E9" BorderBrush="#4CAF50" BorderThickness="2" 
                    CornerRadius="5" Padding="15,10" Margin="0,20,0,15"
                    Visibility="{Binding ShowSuccessMessage, Converter={StaticResource BoolToVisibilityConverter}}"
                    HorizontalAlignment="Center"
                    MaxWidth="600">
                <TextBlock Text="{Binding SuccessMessage}" 
                           FontSize="14" 
                           Foreground="#2E7D32"
                           TextWrapping="Wrap"
                           FontWeight="SemiBold"
                           TextAlignment="Center"/>
            </Border>
            
            <!-- Save Button -->
            <Button Content="Save Evening Check-In" Command="{Binding SaveCommand}" 
                    HorizontalAlignment="Center" Padding="20,10" FontSize="16" Margin="0,0,0,0"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>

